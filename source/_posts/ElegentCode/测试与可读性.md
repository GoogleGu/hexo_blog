---
title: 测试与可读性
date: 2019-11-27 19:06:05
tags:
    - test
---

## 1. 测试为什么重要

### 安全保障

如果一份代码没有与之配套的测试代码，那么你就没有足够的依据来说服他人（甚至是自己）这份代码是足够健康可用的，如果有相应的测试，那么通过测试的那部分你起码可以保证是代码输出是符合要求的。即使出了测试未能涵盖的bug，通过添加测试可以保证我们的代码测试越来越完善，代码的安全性越来越高。

### 重构中的测试

测试代码让你不用担心对现有代码进行修改和优化。
如果没有充足的测试代码，那么小规模的代码重构会变得非常困难，你的代码库也会十分脆弱，因为改动的代码可能会在你无意识中影响到你没有料及的部分，从而产生bug。如果有完善的测试代码，在重构时你可以进行小步的重构、运行测试循环，以此来保证你的重构没有引入bug（或至少是在已有测试覆盖范围内没有引入bug）。

### 测试代码也是一种项目文档

编写良好的测试，由于其罗列出了对于各种输入所期望的输出，在很多时候可以作为项目文档和注释的补充，更好地解释方法功能。

### 不好的代码难于测试

易于测试的代码往往其设计比较合理，耦合度比较低，因此如果在写代码时心中装着要编写测试代码这个目的时，往往会写出比较易于测试、设计合理的代码。（但是不要为了易于测试而进行一些不必要的设计）

## 2. 测试代码的可读性

对测试代码的可读性要求甚至应该高于生产代码，因为只有易于阅读的测试代码才能便于阅读和修改、添加测试。
随着项目的演进，测试代码也是会跟着一同发生变化的，如果测试代码的可读性很差的话，他人（或几个月后的自己）会因为无法理解旧有测试代码而难以修改测试代码，从而根据新情况胡乱编写几个新测试塞进去，日子一长，测试代码会变得无法维护，最终使得测试代码成为一个笑话。

## 3. 如何编写优秀的测试代码

### 隐藏不重要的细节

如果有类创建、初始化、关闭等这种脚手架代码，应该把这些部分的代码隐藏起来（通过抽取方法等），只把和测试真正有关的代码暴露在主测试方法中。
整个测试的流程一般是构造-操作-检验，大部分测试代码的核心是检测给定输入后，输出是否符合需要的输出，一般这种代码只有一行。如果你发现测试代码里充满了各种繁复的细节，最好整理一下思路，让测试的核心部分凸现出来。

### 测试的名字极其重要

- 由于在测试结果中会将测试的名字输出，所以测试代码的名字就相当于注释，一定要起的意义明确。
- 名字中应该包含：被测试类名，被测试方法名，被测试的情况或bug。
- 不要怕起长名字，测试函数不会被其他代码调用，因此稍微长一些也没有问题。
- 所有的test命名的函数都应该包含测试语句（测试断言语句），不以此命名的函数不能包含测试语句。

### 测试报错

测试的报错结果应该更加可读，这包括将错误的输出值和预期的输出值打印出来，以及将本次测试的输出值展示出来等。

### 输入尽量简单

如果你能用更简单、更容易理解的输入集合来覆盖所有的情况，那么就不要去编写那些复杂的输入集合，测试的一部分可读性也来自于测试的输入集。

### 持续修改

在代码进行修改影响到方法或接口的输入输出时，必须同时修改对应的测试，否则测试就失去了意义。

## 4. 优秀测试的5个原则

### 测试要足够快

测试必须能够快速运行，否则测试就无法被频繁运行，也就失去了测试的意义。

### 独立

测试之间必须独立，测试之间不应当互相干预，任何测试都应该可以独立运行。

### 可重复

测试必须在所有环境下都可以重复通过。

### 可自验证

测试必须能够自动输出通过与否，而不应该由你去查运行日志或比对文本文件等来验证。

### 及时

测试必须要及时编写。单元测试应当在恰好使其通过的生产代码之前进行编写。这样你才会设计更容易测试的代码，促进你去优化代码设计。

## 5. 单元测试与接口测试
